# eBPF ç³»ç»Ÿç›‘æ§å·¥å…·

åŸºäº eBPF æŠ€æœ¯çš„ç°ä»£åŒ–ç³»ç»Ÿç›‘æ§è§£å†³æ–¹æ¡ˆï¼Œæä¾›ä½å¼€é”€ã€é«˜ç²¾åº¦çš„å®æ—¶ç³»ç»Ÿç›‘æ§èƒ½åŠ›ã€‚é‡‡ç”¨ä¾èµ–æ³¨å…¥æ¶æ„è®¾è®¡ï¼Œæ”¯æŒå¤šç§ç›‘æ§å™¨å’Œçµæ´»çš„è¾“å‡ºæ§åˆ¶ã€‚

## ğŸ¯ é¡¹ç›®æ¦‚è¿°

æœ¬å·¥å…·é€šè¿‡ eBPF æŠ€æœ¯æ·±å…¥å†…æ ¸ç©ºé—´ï¼Œå®ç°å¯¹ Linux ç³»ç»Ÿçš„å®æ—¶ç›‘æ§ã€‚é‡‡ç”¨ Python ç”¨æˆ·ç©ºé—´ç¨‹åºç»“åˆ C è¯­è¨€ eBPF å†…æ ¸ç¨‹åºï¼Œæä¾›é«˜æ•ˆçš„æ•°æ®æ”¶é›†å’Œå¤„ç†èƒ½åŠ›ã€‚

### æ ¸å¿ƒä¼˜åŠ¿
- **ä½å¼€é”€ç›‘æ§**ï¼šåŸºäº eBPF æŠ€æœ¯ï¼Œå¯¹ç³»ç»Ÿæ€§èƒ½å½±å“æå°
- **å®æ—¶æ•°æ®**ï¼šæ”¯æŒå®æ—¶äº‹ä»¶æ”¶é›†å’Œæ•°æ®è¾“å‡º
- **æ¨¡å—åŒ–è®¾è®¡**ï¼šç›‘æ§å™¨è‡ªåŠ¨æ³¨å†Œæœºåˆ¶ï¼Œæ˜“äºæ‰©å±•
- **é…ç½®é©±åŠ¨**ï¼šé€šè¿‡ YAML é…ç½®æ–‡ä»¶çµæ´»æ§åˆ¶è¡Œä¸º
- **å¤šè¾“å‡ºæ ¼å¼**ï¼šæ”¯æŒæ§åˆ¶å°æ˜¾ç¤ºå’Œ CSV æ–‡ä»¶å­˜å‚¨
- **ç”Ÿäº§å°±ç»ª**ï¼šé‡‡ç”¨ä¾èµ–æ³¨å…¥å’Œåˆ†å±‚é”æœºåˆ¶ï¼Œç¡®ä¿ç¨³å®šæ€§

## ğŸ›  ç³»ç»Ÿè¦æ±‚

**è¿è¡Œç¯å¢ƒ**
- Linux å†…æ ¸ç‰ˆæœ¬ >= 4.1ï¼ˆæ¨è 4.18+ï¼‰
- Python 3.7+
- root æƒé™

**ç¡¬ä»¶è¦æ±‚**
- CPUï¼š2 æ ¸å¿ƒä»¥ä¸Š
- å†…å­˜ï¼š2GB ä»¥ä¸Š
- å­˜å‚¨ï¼š1GB å¯ç”¨ç©ºé—´

**ä¾èµ–åŒ…**
- `python3-bpfcc`ï¼šBCC Python ç»‘å®š
- `bpfcc-tools`ï¼šBCC å·¥å…·é›†
- `kernel-devel/linux-headers`ï¼šå†…æ ¸å¼€å‘åŒ…
- `python3-yaml`ï¼šYAML é…ç½®è§£æ
- `python3-psutil`ï¼šç³»ç»Ÿä¿¡æ¯è·å–

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. ç¯å¢ƒæ£€æŸ¥ä¸å®‰è£…

**CentOS/RHEL ç³»åˆ—ï¼š**
```bash
# å®‰è£…ä¾èµ–
sudo yum install python3-bpfcc bpfcc-tools kernel-devel-$(uname -r)
sudo yum install python3-yaml python3-psutil
```

**Ubuntu/Debian ç³»åˆ—ï¼š**
```bash
# å®‰è£…ä¾èµ–
sudo apt update
sudo apt install python3-bpfcc bpfcc-tools linux-headers-$(uname -r)
sudo apt install python3-yaml python3-psutil
```

### 2. åŸºæœ¬ä½¿ç”¨

```bash
# è¿›å…¥é¡¹ç›®ç›®å½•
cd ebpf

# é»˜è®¤å¯åŠ¨ï¼ˆæ‰€æœ‰ç›‘æ§å™¨ï¼‰
sudo python3 main.py

# å¯åŠ¨ç‰¹å®šç›‘æ§å™¨
sudo python3 main.py -m exec,func,syscall

# ç›‘æ§ç‰¹å®šè¿›ç¨‹
sudo python3 main.py -p nginx,mysql,redis

# ç›‘æ§ç‰¹å®šç”¨æˆ·
sudo python3 main.py -u root,www-data

# è¯¦ç»†è¾“å‡ºæ¨¡å¼
sudo python3 main.py --verbose
```

### 3. å®ˆæŠ¤è¿›ç¨‹æ¨¡å¼

```bash
# åå°è¿è¡Œ
sudo python3 main.py --daemon

# æŸ¥çœ‹å®ˆæŠ¤è¿›ç¨‹çŠ¶æ€
sudo python3 main.py --daemon-status

# åœæ­¢å®ˆæŠ¤è¿›ç¨‹
sudo python3 main.py --daemon-stop
```

## ğŸ“ é¡¹ç›®ç»“æ„

```
ebpf/
â”œâ”€â”€ main.py                         # ç¨‹åºä¸»å…¥å£
â”œâ”€â”€ src/                            # æºä»£ç ç›®å½•
â”‚   â”œâ”€â”€ ebpf_monitor.py            # ä¸»ç›‘æ§å™¨ç±»
â”‚   â”œâ”€â”€ monitors/                   # ç›‘æ§å™¨æ¨¡å—
â”‚   â”‚   â”œâ”€â”€ base.py                # ç›‘æ§å™¨åŸºç±»
â”‚   â”‚   â”œâ”€â”€ exec.py                # è¿›ç¨‹æ‰§è¡Œç›‘æ§
â”‚   â”‚   â”œâ”€â”€ func.py                # å†…æ ¸å‡½æ•°ç›‘æ§
â”‚   â”‚   â””â”€â”€ syscall.py             # ç³»ç»Ÿè°ƒç”¨ç›‘æ§
â”‚   â”œâ”€â”€ ebpf/                      # eBPF å†…æ ¸ç¨‹åº
â”‚   â”‚   â”œâ”€â”€ exec.c                 # è¿›ç¨‹æ‰§è¡Œç›‘æ§ eBPF ç¨‹åº
â”‚   â”‚   â”œâ”€â”€ func.c                 # å†…æ ¸å‡½æ•°ç›‘æ§ eBPF ç¨‹åº
â”‚   â”‚   â””â”€â”€ syscall.c              # ç³»ç»Ÿè°ƒç”¨ç›‘æ§ eBPF ç¨‹åº
â”‚   â””â”€â”€ utils/                     # å·¥å…·æ¨¡å—
â”‚       â”œâ”€â”€ application_context.py # åº”ç”¨ä¸Šä¸‹æ–‡ï¼ˆä¾èµ–æ³¨å…¥ï¼‰
â”‚       â”œâ”€â”€ config_manager.py      # é…ç½®ç®¡ç†å™¨
â”‚       â”œâ”€â”€ configs.py             # é…ç½®æ•°æ®ç±»
â”‚       â”œâ”€â”€ log_manager.py         # æ—¥å¿—ç®¡ç†å™¨
â”‚       â”œâ”€â”€ monitor_registry.py    # ç›‘æ§å™¨æ³¨å†Œè¡¨
â”‚       â”œâ”€â”€ capability_checker.py  # ç³»ç»Ÿå…¼å®¹æ€§æ£€æŸ¥
â”‚       â”œâ”€â”€ output_controller.py   # è¾“å‡ºæ§åˆ¶å™¨
â”‚       â”œâ”€â”€ data_processor.py      # æ•°æ®å¤„ç†å·¥å…·
â”‚       â”œâ”€â”€ daemon_manager.py      # å®ˆæŠ¤è¿›ç¨‹ç®¡ç†
â”‚       â””â”€â”€ decorators.py          # è£…é¥°å™¨å®šä¹‰
â”œâ”€â”€ config/                        # é…ç½®æ–‡ä»¶
â”‚   â””â”€â”€ monitor_config.yaml        # ä¸»é…ç½®æ–‡ä»¶
â”œâ”€â”€ docs/                          # æ–‡æ¡£ç›®å½•
â”‚   â”œâ”€â”€ ARCHITECTURE.md            # æ¶æ„è®¾è®¡æ–‡æ¡£
â”‚   â””â”€â”€ USER_GUIDE.md              # ç”¨æˆ·ä½¿ç”¨æŒ‡å—
â”œâ”€â”€ logs/                          # æ—¥å¿—æ–‡ä»¶ç›®å½•
â”œâ”€â”€ output/                        # ç›‘æ§æ•°æ®è¾“å‡ºç›®å½•
â””â”€â”€ temp/                          # ä¸´æ—¶æ–‡ä»¶ç›®å½•
```

## ğŸ— æ¶æ„è®¾è®¡

### ä¾èµ–æ³¨å…¥æ¶æ„

ç³»ç»Ÿé‡‡ç”¨ç°ä»£åŒ–çš„ä¾èµ–æ³¨å…¥æ¶æ„ï¼Œé€šè¿‡ `ApplicationContext` ç®¡ç†ç»„ä»¶ç”Ÿå‘½å‘¨æœŸï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    åº”ç”¨å±‚ (Application)                  â”‚
â”‚                main.py + å‘½ä»¤è¡Œæ¥å£                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    æ§åˆ¶å±‚ (Control)                      â”‚
â”‚               eBPFMonitor (ä¸»æ§åˆ¶å™¨)                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   ä¸Šä¸‹æ–‡å±‚ (Context)                     â”‚
â”‚              ApplicationContext (ä¾èµ–æ³¨å…¥)               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   ç®¡ç†å±‚ (Management)                    â”‚
â”‚  ConfigManager | LogManager | MonitorRegistry           â”‚
â”‚  OutputController | CapabilityChecker | DaemonManager   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   ç›‘æ§å±‚ (Monitor)                       â”‚
â”‚    BaseMonitor â†’ ExecMonitor (å¯æ‰©å±•å…¶ä»–ç›‘æ§å™¨)          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   å†…æ ¸å±‚ (Kernel)                        â”‚
â”‚              eBPF Programs (C è¯­è¨€)                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ ¸å¿ƒç»„ä»¶

**ApplicationContext**
- ä¾èµ–æ³¨å…¥å®¹å™¨ï¼Œç®¡ç†æ‰€æœ‰ç»„ä»¶çš„ç”Ÿå‘½å‘¨æœŸ
- æ›¿ä»£ä¼ ç»Ÿå•ä¾‹æ¨¡å¼ï¼Œæé«˜å¯æµ‹è¯•æ€§
- é‡‡ç”¨åˆ†å±‚é”æœºåˆ¶ç¡®ä¿çº¿ç¨‹å®‰å…¨

**eBPFMonitor**
- ä¸»æ§åˆ¶å™¨ï¼Œåè°ƒæ‰€æœ‰ç›‘æ§å™¨çš„å·¥ä½œ
- æ”¯æŒç›®æ ‡è¿›ç¨‹å’Œç”¨æˆ·è¿‡æ»¤
- åˆ†å±‚é”æ¶æ„ä¼˜åŒ–å¹¶å‘æ€§èƒ½

**ç›‘æ§å™¨ç³»ç»Ÿ**
- åŸºäº `@register_monitor` è£…é¥°å™¨è‡ªåŠ¨æ³¨å†Œ
- ç»§æ‰¿ `BaseMonitor` æŠ½è±¡åŸºç±»
- æ”¯æŒè¿è¡Œæ—¶åŠ¨æ€å‘ç°å’ŒåŠ è½½

**è¾“å‡ºæ§åˆ¶**
- æ™ºèƒ½è¾“å‡ºæ¨¡å¼ï¼šå•ç›‘æ§å™¨ï¼ˆæ§åˆ¶å°+æ–‡ä»¶ï¼‰ï¼Œå¤šç›‘æ§å™¨ï¼ˆä»…æ–‡ä»¶ï¼‰
- ç¼“å†²åŒºå’Œæ‰¹å¤„ç†ä¼˜åŒ–æ€§èƒ½
- åˆ†å±‚é”æœºåˆ¶é¿å…è¾“å‡ºç«äº‰

### æ•°æ®æµå‘

```
å†…æ ¸äº‹ä»¶è§¦å‘ â†’ eBPFç¨‹åºæ•è· â†’ BPFæ˜ å°„ç¼“å­˜ â†’ Pythonäº‹ä»¶å›è°ƒ â†’ 
ç›‘æ§å™¨å¤„ç† â†’ æ•°æ®æ ¼å¼åŒ– â†’ è¾“å‡ºæ§åˆ¶å™¨ â†’ CSVæ–‡ä»¶/æ§åˆ¶å°è¾“å‡º
```

## ğŸ“Š ç›‘æ§åŠŸèƒ½

### å½“å‰æ”¯æŒçš„ç›‘æ§å™¨

| ç›‘æ§å™¨ | åŠŸèƒ½æè¿° | eBPFæœºåˆ¶ | è¾“å‡ºå­—æ®µ |
|-------|---------|---------|----------|
| **exec** | è¿›ç¨‹æ‰§è¡Œç›‘æ§ | syscalls tracepoint | æ—¶é—´æˆ³ã€è¿›ç¨‹åã€UIDã€PIDã€PPIDã€è¿”å›å€¼ã€å‘½ä»¤å‚æ•° |
| **func** | å†…æ ¸å‡½æ•°ç›‘æ§ | kprobe | æ—¶é—´æˆ³ã€è¿›ç¨‹ä¿¡æ¯ã€å‡½æ•°å |
| **syscall** | ç³»ç»Ÿè°ƒç”¨ç›‘æ§ | raw_syscalls tracepoint | ç³»ç»Ÿè°ƒç”¨å·ã€åˆ†ç±»ã€æŒç»­æ—¶é—´ã€è¿”å›å€¼ã€é”™è¯¯çŠ¶æ€ |

### ç›‘æ§å™¨è¯¦ç»†è¯´æ˜

**ExecMonitorï¼ˆè¿›ç¨‹æ‰§è¡Œç›‘æ§ï¼‰**
- **æœºåˆ¶**ï¼šä½¿ç”¨ `syscalls:sys_enter_execve` å’Œ `syscalls:sys_exit_execve` tracepoint
- **ç‰¹ç‚¹**ï¼šæ•è·è¿›ç¨‹æ‰§è¡Œå®Œæ•´ä¿¡æ¯ï¼ŒåŒ…æ‹¬å‘½ä»¤è¡Œå‚æ•°ï¼ˆæœ€å¤š4ä¸ªï¼‰
- **åº”ç”¨åœºæ™¯**ï¼šè¿›ç¨‹å¯åŠ¨ç›‘æ§ã€å®‰å…¨å®¡è®¡ã€æ€§èƒ½åˆ†æ

**FuncMonitorï¼ˆå†…æ ¸å‡½æ•°ç›‘æ§ï¼‰**
- **æœºåˆ¶**ï¼šä½¿ç”¨ kprobe åŠ¨æ€æ¢é’ˆæŠ€æœ¯
- **ç‰¹ç‚¹**ï¼šæ”¯æŒé€šé…ç¬¦æ¨¡å¼åŒ¹é…ï¼ˆå¦‚ `vfs_*`ï¼‰ï¼ŒåŠ¨æ€ç”Ÿæˆæ¢é’ˆï¼Œå¯é…ç½®æ¢é’ˆæ•°é‡é™åˆ¶
- **åº”ç”¨åœºæ™¯**ï¼šå†…æ ¸å¼€å‘è°ƒè¯•ã€æ€§èƒ½çƒ­ç‚¹åˆ†æã€å‡½æ•°è°ƒç”¨è·Ÿè¸ª
- **é…ç½®ç¤ºä¾‹**ï¼š
  ```yaml
  func:
    enabled: true
    patterns: ["vfs_*", "sys_*"]  # ç›‘æ§VFSå’Œç³»ç»Ÿè°ƒç”¨ç›¸å…³å‡½æ•°
    probe_limit: 10               # æœ€å¤š10ä¸ªæ¢é’ˆ
  ```

**SyscallMonitorï¼ˆç³»ç»Ÿè°ƒç”¨ç›‘æ§ï¼‰**
- **æœºåˆ¶**ï¼šä½¿ç”¨ `raw_syscalls:sys_enter` å’Œ `raw_syscalls:sys_exit` tracepoint
- **ç‰¹ç‚¹**ï¼šæ™ºèƒ½åˆ†ç±»ï¼ˆæ–‡ä»¶IOã€ç½‘ç»œã€å†…å­˜ã€è¿›ç¨‹ã€ä¿¡å·ã€æ—¶é—´ï¼‰ï¼Œæ”¯æŒæ€§èƒ½é˜ˆå€¼å’Œé‡‡æ ·ç­–ç•¥
- **åº”ç”¨åœºæ™¯**ï¼šç³»ç»Ÿè°ƒç”¨æ€§èƒ½åˆ†æã€å¼‚å¸¸æ£€æµ‹ã€èµ„æºä½¿ç”¨ç›‘æ§
- **é…ç½®ç¤ºä¾‹**ï¼š
  ```yaml
  syscall:
    enabled: true
    sampling_strategy: "intelligent"
    monitor_categories:
      file_io: true
      network: true
      memory: true
      process: true
      signal: false
      time: false
    performance_thresholds:
      file_io_ms: 1.0
      network_ms: 5.0
      memory_ms: 0.5
      process_ms: 10.0
      default_us: 100
  ```

## âš™ï¸ é…ç½®ç®¡ç†

### é…ç½®æ–‡ä»¶ç»“æ„

`config/monitor_config.yaml` åŒ…å«å››ä¸ªä¸»è¦éƒ¨åˆ†ï¼š

```yaml
# åº”ç”¨é…ç½®
app:
  name: ebpf_monitor
  version: 1.0.0
  debug: true
  environment: development

# æ—¥å¿—é…ç½®
logging:
  level: DEBUG
  formatters:
    detailed:
      format: '%(asctime)s [%(levelname)s] %(name)s:%(lineno)d %(message)s'
  handlers:
    console:
      class: logging.StreamHandler
      formatter: simple
    file:
      class: logging.handlers.TimedRotatingFileHandler
      formatter: detailed
      filename: monitor.log
      when: D
      interval: 1
      backupCount: 365

# è¾“å‡ºæ§åˆ¶å™¨é…ç½®
output:
  buffer_size: 2000        # äº‹ä»¶ç¼“å†²åŒºå¤§å°
  flush_interval: 2.0      # åˆ·æ–°é—´éš”ï¼ˆç§’ï¼‰
  csv_delimiter: ","       # CSVåˆ†éš”ç¬¦
  include_header: true     # æ˜¯å¦åŒ…å«è¡¨å¤´

# ç›‘æ§å™¨é…ç½®
monitors:
  exec:
    enabled: true
  
  func:
    enabled: true
    patterns: ["vfs_*"]          # åŒ¹é…æ¨¡å¼
    probe_limit: 10              # æœ€å¤§æ¢é’ˆæ•°é‡
  
  syscall:
    enabled: true
    sampling_strategy: "intelligent"
    high_priority_syscalls: [0, 1, 2, 3, 9, 57, 59]
    monitor_categories:
      file_io: true
      network: true
      memory: true
      process: true
      signal: false
      time: false
    performance_thresholds:
      file_io_ms: 1.0
      network_ms: 5.0
      memory_ms: 0.5
      process_ms: 10.0
      default_us: 100
    max_events_per_second: 1000
    show_errors_only: false
```

### é…ç½®ç‰¹ç‚¹

- **åŠ¨æ€é…ç½®å‘ç°**ï¼šç›‘æ§å™¨é…ç½®é€šè¿‡ `MonitorsConfig` è‡ªåŠ¨å‘ç°
- **ç±»å‹å®‰å…¨éªŒè¯**ï¼šä½¿ç”¨ dataclass ç¡®ä¿é…ç½®ç±»å‹æ­£ç¡®
- **é»˜è®¤å€¼æ”¯æŒ**ï¼šæ¯ä¸ªç›‘æ§å™¨æä¾›åˆç†çš„é»˜è®¤é…ç½®
- **é”™è¯¯å¤„ç†**ï¼šè¯¦ç»†çš„é…ç½®éªŒè¯å’Œé”™è¯¯æŠ¥å‘Š

## ğŸ“„ è¾“å‡ºæ•°æ®æ ¼å¼

### CSV æ–‡ä»¶è¾“å‡º

ç›‘æ§æ•°æ®æŒ‰ç›‘æ§å™¨ç±»å‹åˆ†åˆ«å­˜å‚¨ä¸º CSV æ–‡ä»¶ï¼Œæ–‡ä»¶åæ ¼å¼ä¸º `{ç›‘æ§å™¨}_{æ—¶é—´æˆ³}.csv`ï¼š

```
output/
â”œâ”€â”€ exec_20250924_143045.csv      # è¿›ç¨‹æ‰§è¡Œç›‘æ§æ•°æ®
â”œâ”€â”€ func_20250924_143045.csv      # å†…æ ¸å‡½æ•°ç›‘æ§æ•°æ®
â””â”€â”€ syscall_20250924_143045.csv   # ç³»ç»Ÿè°ƒç”¨ç›‘æ§æ•°æ®
```

**ExecMonitor CSV æ•°æ®ç¤ºä¾‹**ï¼š
```csv
timestamp,time_str,comm,uid,pid,ppid,ret,argv
1726123845.123,[2025-09-12 14:30:45.123],nginx,0,1234,1,0,"nginx -g daemon off;"
1726123845.234,[2025-09-12 14:30:45.234],mysql,999,5678,1,0,"mysqld --defaults-file=/etc/mysql/my.cnf"
```

**FuncMonitor CSV æ•°æ®ç¤ºä¾‹**ï¼š
```csv
timestamp,time_str,pid,ppid,uid,comm,func_name
1726123845.345,[2025-09-12 14:30:45.345],1234,1,0,nginx,vfs_read
1726123845.456,[2025-09-12 14:30:45.456],5678,1,999,mysql,vfs_write
```

**SyscallMonitor CSV æ•°æ®ç¤ºä¾‹**ï¼š
```csv
timestamp,time_str,monitor_type,pid,tid,cpu,comm,syscall_nr,syscall_name,category,ret_val,error_name,duration_ns,duration_us,duration_ms,is_error,is_slow_call
1726123845.123,[2025-09-12 14:30:45.123],syscall,1234,1234,2,nginx,2,open,file_io,3,SUCCESS,15000,15.0,0.015,false,false
```

### æ§åˆ¶å°å®æ—¶è¾“å‡º

å½“åªå¯åŠ¨å•ä¸ªç›‘æ§å™¨æ—¶ï¼Œæ”¯æŒæ§åˆ¶å°å®æ—¶æ˜¾ç¤ºï¼š

```
TIME                   COMM             UID    PID      PPID     RET  ARGS
[2025-09-12 14:30:45]  nginx            0      1234     1        0    nginx -g daemon off;
[2025-09-12 14:30:46]  mysql            999    5678     1        0    mysqld --defaults-file=/etc/mysql/my.cnf
```

## ğŸ”§ å¼€å‘å’Œæ‰©å±•

### æ·»åŠ æ–°ç›‘æ§å™¨

1. **åˆ›å»º eBPF ç¨‹åº**
```c
// src/ebpf/custom.c
struct custom_event {
    u64 timestamp;
    // è‡ªå®šä¹‰å­—æ®µ
};

BPF_PERF_OUTPUT(custom_events);

TRACEPOINT_PROBE(custom, event_name) {
    // ç›‘æ§é€»è¾‘
    return 0;
}
```

2. **å®ç° Python ç›‘æ§å™¨**
```python
# src/monitors/custom.py
@register_monitor("custom")
class CustomMonitor(BaseMonitor):
    EVENT_TYPE = CustomEvent
    
    def get_csv_header(self):
        return ['timestamp', 'custom_field']
    
    def format_for_csv(self, event_data):
        return {
            'timestamp': self._convert_timestamp(event_data),
            'custom_field': event_data.custom_field
        }
```

3. **æ·»åŠ é…ç½®æ”¯æŒ**
```yaml
# config/monitor_config.yaml
monitors:
  custom:
    enabled: true
    custom_option: value
```

## ğŸ› æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

**1. æƒé™é”™è¯¯**
```bash
# é”™è¯¯ï¼šPermission denied
# è§£å†³ï¼šä½¿ç”¨ root æƒé™
sudo python3 main.py
```

**2. eBPF ä¸æ”¯æŒ**
```bash
# æ£€æŸ¥å†…æ ¸ç‰ˆæœ¬
uname -r

# æ£€æŸ¥ eBPF æ”¯æŒ
ls /sys/fs/bpf/

# æ£€æŸ¥å†…æ ¸é…ç½®
zcat /proc/config.gz | grep CONFIG_BPF
```

**3. ä¾èµ–åŒ…ç¼ºå¤±**
```bash
# CentOS/RHEL
sudo yum install python3-bpfcc bpfcc-tools

# Ubuntu/Debian
sudo apt install python3-bpfcc bpfcc-tools
```

### è°ƒè¯•æ–¹æ³•

**å¯ç”¨è¯¦ç»†æ—¥å¿—**
```bash
sudo python3 main.py --verbose
```

**æŸ¥çœ‹æ—¥å¿—**
```bash
# å®æ—¶æŸ¥çœ‹
tail -f logs/monitor.log

# æŸ¥çœ‹é”™è¯¯
grep ERROR logs/monitor.log
```

## âš¡ æ€§èƒ½ä¼˜åŒ–

### é…ç½®è°ƒä¼˜

**ç¼“å†²åŒºä¼˜åŒ–**
```yaml
output:
  buffer_size: 4000        # å¢å¤§ç¼“å†²åŒº
  flush_interval: 5.0      # è°ƒæ•´åˆ·æ–°é—´éš”
```

**ç›‘æ§å™¨é€‰æ‹©**
```bash
# åªå¯ç”¨å¿…è¦çš„ç›‘æ§å™¨
sudo python3 main.py -m exec

# é’ˆå¯¹ç‰¹å®šç›®æ ‡
sudo python3 main.py -p nginx,mysql
```

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [æ¶æ„è®¾è®¡æ–‡æ¡£](docs/ARCHITECTURE.md) - è¯¦ç»†çš„ç³»ç»Ÿæ¶æ„å’Œè®¾è®¡åŸç†
- [ç”¨æˆ·ä½¿ç”¨æŒ‡å—](docs/USER_GUIDE.md) - å®Œæ•´çš„å®‰è£…é…ç½®å’Œä½¿ç”¨è¯´æ˜

## ğŸ¤ è´¡çŒ®

æ¬¢è¿æäº¤ Issue å’Œ Pull Request æ¥æ”¹è¿›æœ¬é¡¹ç›®ã€‚

## ğŸ’¡ æŠ€æœ¯æ”¯æŒ

é‡åˆ°é—®é¢˜æ—¶è¯·æŒ‰ä»¥ä¸‹æ­¥éª¤æ’æŸ¥ï¼š

1. æŸ¥çœ‹ [æ•…éšœæ’é™¤](#ğŸ›-æ•…éšœæ’é™¤) ç« èŠ‚
2. æ£€æŸ¥è¿è¡Œæ—¥å¿—ï¼š`tail -f logs/monitor.log`
3. åœ¨ GitHub Issues ä¸­æäº¤é—®é¢˜æŠ¥å‘Š

---

**é‡è¦æç¤º**ï¼šæœ¬å·¥å…·éœ€è¦ root æƒé™è¿è¡Œï¼Œè¯·åœ¨å®‰å…¨å¯æ§çš„ç¯å¢ƒä¸­ä½¿ç”¨ã€‚æ‰€æœ‰ç›‘æ§æ•°æ®ä»…å­˜å‚¨åœ¨é¡¹ç›®ç›®å½•å†…ï¼Œä¸ä¼šå½±å“ç³»ç»Ÿå…¶ä»–éƒ¨åˆ†ã€‚